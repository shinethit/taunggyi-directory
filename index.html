<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cherry Directory</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cherry Directory">
    <link rel="apple-touch-icon" href="CDST_Logo.png">
    <link rel="icon" type="image/png" sizes="192x192" href="CDST_Logo.png">
    <link rel="icon" type="image/png" sizes="512x512" href="CDST_Logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; padding-bottom: 110px; background-color: #f8f5ff; }
        .page { display: none; opacity: 0; }
        .active-page { display: block; opacity: 1; transition: opacity 0.3s; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #FFD700 50%, #B8860B 100%); }
        .purple-gradient { background: linear-gradient(135deg, #37006a 0%, #5e0a9e 100%); }
        .viber-bg { background-color: #7360f2; }
        .telegram-bg { background-color: #229ED9; }

        /* Blog Style Formatting */
        .post-content { white-space: pre-wrap; line-height: 1.8; word-break: break-word; }

        /* Full Contain Gallery */
        .gallery-scroll { display: flex; overflow-x: auto; gap: 12px; padding: 5px; scroll-snap-type: x mandatory; }
        .gallery-item { flex: 0 0 100%; scroll-snap-align: center; height: 300px; background: #000; border-radius: 16px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .gallery-item img { width: 100%; height: 100%; object-fit: contain; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <header class="purple-gradient text-white shadow-lg rounded-b-[20px] border-b-2 border-[#D4AF37] relative z-0">
        <div class="bg-black/20 px-4 py-1 flex justify-between items-center text-[10px] font-mono text-[#FFD700]">
            <span id="fullDate">LOADING DATE...</span>
            <span id="timeClock" class="font-bold text-white">00:00</span>
        </div>
        <div class="flex items-center gap-3 p-3">
            <img src="CDST_Logo.png" alt="Logo" class="w-10 h-10 rounded-lg border border-[#FFD700] shadow-sm object-cover bg-[#37006a]" onerror="this.style.display='none'">
            <div class="text-left leading-tight">
                <h1 class="text-lg font-bold tracking-wider text-white">Cherry Directory</h1>
                <div class="flex items-center text-[9px] text-gray-300 gap-2">
                    <span><i class="fa fa-eye mr-0.5"></i><span id="viewCounter">...</span> Views</span>
                    <span><i class="fa fa-circle text-green-400 text-[6px] mr-0.5 animate-pulse"></i> Online</span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto p-4 mt-1 mb-20 relative">
        <section id="homePage" class="page active-page space-y-3">
            <div class="flex overflow-x-auto gap-2 pb-2 no-scrollbar" id="eventFilters"></div>
            <div id="announcementList" class="space-y-6 pb-4">
                <div class="text-center text-gray-400 py-10 font-bold">News & Events များ ဆွဲယူနေပါသည်...</div>
            </div>
        </section>

        <section id="directoryPage" class="page">
            <div class="sticky top-0 z-30 bg-[#f8f5ff]/95 backdrop-blur-sm py-2 space-y-2">
                <div class="relative">
                    <input type="text" id="searchInput" onkeyup="handleSearch()" placeholder="ဆိုင်အမည်၊ ရပ်ကွက် ရှာရန်..." class="w-full p-2.5 pl-9 rounded-xl shadow-sm border border-[#D4AF37] outline-none text-sm">
                    <i class="fa fa-search absolute left-3 top-3 text-[#D4AF37]"></i>
                </div>
                <div class="flex overflow-x-auto gap-2 pb-1 no-scrollbar" id="dirFilters"></div>
            </div>
            <div id="directoryList" class="space-y-6 mt-2 pb-4">
                <div class="text-center text-gray-400 py-10 font-bold">လုပ်ငန်းလိပ်စာများ ဆွဲယူနေပါသည်...</div>
            </div>
        </section>

        <section id="contactPage" class="page space-y-4">
            <div class="bg-white p-5 rounded-2xl shadow-md border-l-4 border-[#D4AF37] mb-2 relative overflow-hidden">
                <h3 class="font-bold text-[#4B0082] text-md mb-1">လုပ်ငန်းရှင်များအတွက်</h3>
                <p class="text-xs text-gray-600 mb-3">မိမိတို့ လုပ်ငန်းကို Cherry Directory တွင် ထည့်သွင်းလိုပါက Form ဖြည့်စွက်ပေးပါ။</p>
                <a id="regBtn" target="_blank" class="inline-block gold-gradient text-white text-xs font-bold px-4 py-2 rounded-lg shadow cursor-pointer">စာရင်းသွင်းရန်</a>
            </div>
            <div id="adminProfileArea"></div>
            <div id="adminNotesArea" class="space-y-3"></div>
        </section>

        <section id="detailPage" class="fixed inset-0 bg-[#f8f5ff] z-[100] overflow-y-auto hidden">
            <div class="sticky top-0 bg-white/95 backdrop-blur-md p-3 shadow-sm z-50 flex items-center border-b border-gray-200">
                <button onclick="closeDetail()" class="w-9 h-9 rounded-full bg-gray-100 text-[#4B0082] flex items-center justify-center hover:bg-[#D4AF37] hover:text-white"><i class="fa fa-arrow-left"></i></button>
                <span class="ml-3 font-bold text-[#4B0082] truncate text-sm" id="detailHeader">Details</span>
            </div>
            <div id="detailContent" class="p-5 max-w-2xl mx-auto pb-24"></div>
        </section>
    </div>

    <nav id="bottomNav" class="fixed bottom-4 left-4 right-4 bg-[#37006a] text-gray-400 flex justify-around items-center p-2 shadow-2xl z-[50] rounded-2xl border border-[#D4AF37]/50 transition-transform duration-300">
        <button onclick="showPage('home')" class="nav-item flex flex-col items-center p-2 w-16 text-[#FFD700]" id="nav-home"><i class="fa fa-home text-lg mb-0.5"></i><span class="text-[9px] font-bold">Home</span></button>
        <button onclick="showPage('directory')" class="nav-item flex flex-col items-center p-2 w-16 relative" id="nav-directory"><div class="bg-[#D4AF37] text-[#37006a] w-10 h-10 rounded-full flex items-center justify-center -mt-6 shadow border-4 border-[#f8f5ff]"><i class="fa fa-search text-lg font-bold"></i></div><span class="text-[9px] font-bold mt-1">Search</span></button>
        <button onclick="showPage('contact')" class="nav-item flex flex-col items-center p-2 w-16 hover:text-gray-200" id="nav-contact"><i class="fa fa-info-circle text-lg mb-0.5"></i><span class="text-[9px] font-bold">Admin</span></button>
    </nav>

    <script>
        const SHEET_ID = '1rMGmfDW5AsBZGJJw5H8HyavOQiIuMr-pPvXpShktYxQ';
        const GID_HOME = '0';
        const GID_DIR = '1267218282';
        const GID_CONTACT = '626044868';

        const REG_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdFGRd57WIpOOJDnZI4U9vrtZAsJCW6pRiP1WvQDrXZeRy5xA/viewform?usp=dialog";
        const REVIEW_URL = "https://docs.google.com/forms/d/e/1FAIpQLSce4TGjXal4s0wmeNyGBdO3cg8ymNgXlilu1o_8R3-Q9LMYyw/viewform?usp=dialog";
        document.getElementById('regBtn').href = REG_URL;

        const BASE_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
        let eventsData = [], dirData = [];
        let activeDirCat = 'All', activeEventCat = 'All';

        function fixDriveLink(url) {
            if (!url || url === "" || url === "-") return 'CDST_Logo.png';
            if (url.includes('drive.google.com')) {
                let fileId = "";
                if (url.includes('/d/')) fileId = url.split('/d/')[1].split('/')[0];
                else if (url.includes('id=')) fileId = url.split('id=')[1].split('&')[0];
                if (fileId) return `http://googleusercontent.com/profile/picture/8{fileId}`;
            }
            return url;
        }

        function updateTime() {
            const now = new Date();
            let h = now.getHours(); const m = now.getMinutes().toString().padStart(2, '0');
            const ampm = h >= 12 ? 'PM' : 'AM'; h = h % 12 || 12;
            document.getElementById('timeClock').innerText = `${h}:${m} ${ampm}`;
            const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
            const daysMm = ["တနင်္ဂနွေ","တနင်္လာ","အင်္ဂါ","ဗုဒ္ဓဟူး","ကြာသပတေး","သောကြာ","စနေ"];
            document.getElementById('fullDate').innerText = `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} | ${daysMm[now.getDay()]}`;
        }
        setInterval(updateTime, 1000); updateTime();

        function getStars(rating) {
            if(!rating) return '<span class="text-[10px] text-gray-300">(No Rating)</span>';
            let h = '<div class="flex text-orange-400 text-[10px] gap-0.5">';
            for(let i=1; i<=5; i++) h += (i <= rating) ? '<i class="fa fa-star"></i>' : (i-0.5 <= rating) ? '<i class="fa fa-star-half-alt"></i>' : '<i class="far fa-star text-gray-200"></i>';
            h += ` <span class="text-gray-400 ml-1">(${rating})</span></div>`;
            return h;
        }

        async function loadAllData() {
            // Restore Local Storage Caching
            const cEvents = localStorage.getItem('cache_events');
            const cDir = localStorage.getItem('cache_dir');
            const cAdmin = localStorage.getItem('cache_admin');
            if(cEvents) { eventsData = JSON.parse(cEvents); setupFilters('eventFilters', eventsData, (c) => { activeEventCat = c; renderEvents(); }); renderEvents(); }
            if(cDir) { dirData = JSON.parse(cDir); setupFilters('dirFilters', dirData, (c) => { activeDirCat = c; handleSearch(); }); renderDirectory(); }
            if(cAdmin) { renderAdminArea(JSON.parse(cAdmin)); }

            const ns = 'cherry-directory-' + SHEET_ID.substr(0,5);
            fetch(`https://api.countapi.xyz/hit/${ns}/visits`).then(res => res.json()).then(data => { document.getElementById('viewCounter').innerText = data.value || '1.2K'; }).catch(() => { document.getElementById('viewCounter').innerText = '1.2K'; });

            fetchEvents(); fetchDirectory(); fetchAdmin();
        }

        async function fetchEvents() {
            try {
                const res = await fetch(`${BASE_URL}&gid=${GID_HOME}`);
                const text = await res.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                eventsData = json.table.rows.map(r => ({ cat: r.c[0]?.v, title: r.c[1]?.v, desc: r.c[2]?.v, fromDate: r.c[3]?.v, toDate: r.c[4]?.v, time: r.c[5]?.v, place: r.c[6]?.v, org: r.c[7]?.v, logo: r.c[8]?.v, images: [r.c[9]?.v, r.c[10]?.v, r.c[11]?.v, r.c[12]?.v, r.c[13]?.v].filter(Boolean) }))
                .filter(i => i.title && i.title !== "Title").reverse();
                localStorage.setItem('cache_events', JSON.stringify(eventsData));
                setupFilters('eventFilters', eventsData, (c) => { activeEventCat = c; renderEvents(); });
                renderEvents();
            } catch (e) {}
        }

        async function fetchDirectory() {
            try {
                const res = await fetch(`${BASE_URL}&gid=${GID_DIR}`);
                const text = await res.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                dirData = json.table.rows.map(r => ({ name: r.c[0]?.v, cat: r.c[1]?.v, type: r.c[2]?.v, desc: r.c[3]?.v, addr: r.c[4]?.v, ward: r.c[5]?.v, city: r.c[6]?.v, ph1: r.c[7]?.v, ph2: r.c[8]?.v, ph3: r.c[9]?.v, viber: r.c[10]?.v, telegram: r.c[11]?.v, email: r.c[12]?.v, img: r.c[13]?.v, rating: r.c[14]?.v, note: r.c[15]?.v }))
                .filter(i => i.name && i.name !== "Name");
                localStorage.setItem('cache_dir', JSON.stringify(dirData));
                setupFilters('dirFilters', dirData, (c) => { activeDirCat = c; handleSearch(); });
                renderDirectory();
            } catch (e) {}
        }

        async function fetchAdmin() {
            try {
                const res = await fetch(`${BASE_URL}&gid=${GID_CONTACT}`);
                const text = await res.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                localStorage.setItem('cache_admin', JSON.stringify(json.table.rows));
                renderAdminArea(json.table.rows);
            } catch (e) {}
        }

        function renderAdminArea(rows) {
            const profile = rows.find(r => r.c[0]?.v && r.c[0].v !== "Description");
            if (profile) {
                document.getElementById('adminProfileArea').innerHTML = `
                <div class="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-[#4B0082] mb-6">
                    <div class="mb-4 text-center border-b pb-4"><i class="fa fa-user-shield text-3xl text-[#4B0082] mb-2"></i><h3 class="font-bold text-lg text-[#4B0082]">Admin Profile</h3></div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-start border-b border-gray-50 pb-2"><span class="text-[10px] text-gray-400 uppercase">Description</span><span class="text-xs font-bold text-[#4B0082] text-right ml-4">${profile.c[0]?.v || '-'}</span></div>
                        ${renderAdminBtn('Phone 1', profile.c[1]?.v, 'tel:', 'fa-phone-alt', 'bg-green-500')}
                        ${renderAdminBtn('Phone 2', profile.c[2]?.v, 'tel:', 'fa-phone-alt', 'bg-green-500')}
                        ${renderAdminBtn('Viber Chat', profile.c[3]?.v, 'viber://chat?number=', 'fa-viber', 'viber-bg', true)}
                        ${renderAdminBtn('Telegram Chat', profile.c[4]?.v, 'https://t.me/', 'fa-telegram', 'telegram-bg', false, true)}
                        ${renderAdminBtn('Email Admin', profile.c[5]?.v, 'mailto:', 'fa-envelope', 'bg-red-500')}
                    </div>
                </div>`;
            }
            const notes = rows.slice(1).map(r => r.c[6]?.v).filter(Boolean);
            document.getElementById('adminNotesArea').innerHTML = notes.map(note => `
                <div class="bg-yellow-400 border-l-8 border-[#B8860B] p-5 rounded-r-2xl shadow-lg slide-up">
                    <h4 class="font-bold text-sm text-[#37006a] uppercase flex items-center gap-2 mb-2 tracking-widest"><i class="fa fa-bullhorn animate-bounce"></i> ANNOUNCEMENT</h4>
                    <p class="text-lg text-[#37006a] font-bold post-content">${note}</p>
                </div>`).join('');
        }

        function renderAdminBtn(lbl, val, pref, icon, cls, isFab=false, isTg=false) {
            if(!val || val === "-" || val === "") return '';
            let lnk = pref + (isTg ? val.toString().replace('@','') : val);
            return `<a href="${lnk}" class="flex items-center justify-between ${cls} text-white p-3 rounded-xl shadow-md transition active:scale-95"><span class="font-bold text-xs">${lbl}: ${val}</span><i class="${isFab?'fab':'fa'} ${icon}"></i></a>`;
        }

        function setupFilters(cid, data, cb) {
            const cats = ['All', ...new Set(data.map(i => i.cat).filter(Boolean))];
            const cont = document.getElementById(cid);
            cont.innerHTML = cats.map(c => `<button class="filter-btn flex-shrink-0 px-4 py-1.5 rounded-full text-[10px] font-bold border transition-all ${c===(cid==='eventFilters'?activeEventCat:activeDirCat)?'bg-[#D4AF37] text-white border-[#D4AF37]':'bg-white text-gray-600 border-gray-200'}">${c}</button>`).join('');
            cont.querySelectorAll('button').forEach((btn, idx) => {
                btn.onclick = () => {
                    cont.querySelectorAll('button').forEach(b => { b.classList.remove('bg-[#D4AF37]','text-white','border-[#D4AF37]'); b.classList.add('bg-white','text-gray-600','border-gray-200'); });
                    btn.classList.add('bg-[#D4AF37]','text-white','border-[#D4AF37]'); btn.classList.remove('bg-white','text-gray-600','border-gray-200');
                    cb(cats[idx]);
                };
            });
        }

        function renderEvents() {
            const list = document.getElementById('announcementList');
            let data = activeEventCat === 'All' ? eventsData : eventsData.filter(e => e.cat === activeEventCat);
            if(!data.length) { list.innerHTML = '<p class="text-center text-gray-400 py-10">No events found.</p>'; return; }
            const groups = data.reduce((a, i) => { a[i.cat] = a[i.cat] || []; a[i.cat].push(i); return a; }, {});
            list.innerHTML = Object.keys(groups).map(cat => `
                <div class="mb-4"><h3 class="font-bold text-[#D4AF37] text-[10px] uppercase tracking-widest mb-2 border-l-4 border-[#D4AF37] pl-2">${cat}</h3>
                <div class="space-y-3">${groups[cat].map(i => `
                    <div onclick="openDetail('event', ${eventsData.indexOf(i)})" class="bg-white rounded-xl shadow-sm p-3 flex gap-3 cursor-pointer active:scale-95 transition-transform"><img src="${fixDriveLink(i.images[0] || i.logo)}" class="w-20 h-20 rounded-lg object-cover bg-gray-100" onerror="this.src='CDST_Logo.png'"><div class="flex-1 flex flex-col justify-center"><h4 class="font-bold text-[#4B0082] text-sm leading-tight break-words">${i.title}</h4><p class="text-[10px] text-gray-500 mt-1 line-clamp-2">${i.desc || ''}</p><span class="text-[9px] text-[#D4AF37] font-bold mt-2 uppercase">View Details <i class="fa fa-arrow-right ml-1"></i></span></div></div>`).join('')}</div></div>`).join('');
        }

        function renderDirectory() {
            const list = document.getElementById('directoryList');
            const term = document.getElementById('searchInput').value.toLowerCase();
            let data = dirData.filter(d => (activeDirCat === 'All' || d.cat === activeDirCat) && (d.name.toLowerCase().includes(term) || (d.ward && d.ward.toLowerCase().includes(term))));
            if(!data.length) { list.innerHTML = '<p class="text-center text-gray-400 mt-10">No results found.</p>'; return; }
            const groups = data.reduce((a, i) => { a[i.cat] = a[i.cat] || []; a[i.cat].push(i); return a; }, {});
            list.innerHTML = Object.keys(groups).map(c => `
                <div class="mb-5"><h3 class="font-bold text-[#4B0082] text-xs bg-gray-100 px-3 py-1 rounded-lg inline-block mb-3">${c}</h3><div class="grid grid-cols-1 gap-3">${groups[c].map(i => `
                    <div onclick="openDetail('dir', ${dirData.indexOf(i)})" class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex gap-3 items-start cursor-pointer active:scale-95 transition-transform"><img src="${fixDriveLink(i.img)}" class="w-14 h-14 rounded-lg object-cover bg-gray-50 border" onerror="this.src='CDST_Logo.png'"><div class="flex-1 overflow-hidden"><div class="flex justify-between items-start mb-1"><h4 class="font-bold text-[#4B0082] text-sm leading-tight break-words">${i.name}</h4><span class="text-[8px] bg-purple-50 text-purple-600 px-1.5 py-0.5 rounded border border-purple-100 flex-shrink-0">${i.type || ''}</span></div>
                    <div class="mb-1">${getStars(i.rating)}</div><p class="text-[10px] text-gray-500 leading-snug break-words line-clamp-1">${i.desc || '-'}</p><div class="flex items-center mt-2 text-[10px] text-[#D4AF37] font-bold"><i class="fa fa-map-pin mr-1"></i> ${i.ward || 'Taunggyi'}</div></div></div>`).join('')}</div></div>`).join('');
        }

        function handleSearch() { renderDirectory(); }

        function openDetail(type, index) {
            const modal = document.getElementById('detailPage'); const content = document.getElementById('detailContent');
            
            // Helper UI Functions
            const renderR = (l, v) => `<div class="border-b border-gray-50 py-3"><p class="text-[10px] text-gray-400 mb-0.5 uppercase tracking-wider font-bold">${l}</p><div class="text-gray-800 font-medium text-sm post-content">${v || '-'}</div></div>`;
            const renderP = (l, v) => v ? `<div class="border-b border-gray-50 py-3 flex justify-between items-center"><div><p class="text-[10px] text-gray-400 mb-0.5 uppercase font-bold">${l}</p><p class="text-[#4B0082] font-bold text-sm font-mono">${v}</p></div><a href="tel:${v}" class="bg-green-500 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold shadow-sm active:scale-90"><i class="fa fa-phone mr-1"></i> CALL</a></div>` : '';
            const renderC = (l, v, i, c, lp) => v ? `<div class="border-b border-gray-50 py-3 flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-400"><i class="${i}"></i></div><div><p class="text-[10px] text-gray-400 font-bold uppercase">${l}</p><p class="text-xs font-bold text-gray-700">${v}</p></div></div><a href="${lp}${v.toString().replace('@','')}" target="_blank" class="${c} text-white px-3 py-1 rounded-lg text-[10px] font-bold shadow-sm active:scale-90">CHAT</a></div>` : '';

            if(type === 'event') {
                const i = eventsData[index]; document.getElementById('detailHeader').innerText = "Post Details";
                const imgs = i.images.length > 0 ? i.images : [i.logo].filter(Boolean);
                content.innerHTML = `<div class="space-y-4 slide-up"><div class="bg-white p-5 rounded-2xl shadow-sm border-b-4 border-[#D4AF37]"><h2 class="text-lg font-bold text-[#4B0082] leading-tight mb-2">${i.title}</h2><span class="text-[9px] bg-[#D4AF37] text-white px-2 py-0.5 rounded-full uppercase inline-block">${i.cat}</span></div>${imgs.length > 0 ? `<div class="bg-white p-2 rounded-2xl shadow-sm"><div class="gallery-scroll">${imgs.map(img => `<div class="gallery-item"><img src="${fixDriveLink(img)}" onclick="window.open(this.src)"></div>`).join('')}</div><p class="text-[9px] text-center text-gray-400 mt-2 italic"><i class="fa fa-arrow-left mr-1"></i> Swipe for all images <i class="fa fa-arrow-right ml-1"></i></p></div>` : ''}<div class="bg-white p-5 rounded-2xl shadow-sm"><h3 class="font-bold text-[#4B0082] border-b pb-2 mb-2 text-xs uppercase tracking-widest"><i class="fa fa-info-circle mr-2 text-[#D4AF37]"></i> Information</h3>${renderR('Description', i.desc)}${renderR('From', i.fromDate)}${renderR('To', i.toDate)}${renderR('Time', i.time)}${renderR('Place', i.place)}</div></div>`;
            } else {
                const i = dirData[index]; document.getElementById('detailHeader').innerText = i.name;
                content.innerHTML = `
                    <div class="space-y-4 slide-up">
                        <div class="bg-white rounded-3xl p-5 shadow-lg border-b-4 border-[#D4AF37] text-center">
                            <img src="${fixDriveLink(i.img)}" class="w-28 h-28 rounded-xl object-cover mx-auto mb-3 border-2 shadow-sm bg-white" onerror="this.src='CDST_Logo.png'">
                            <h2 class="text-xl font-bold text-[#4B0082] leading-tight break-words">${i.name}</h2>
                            <div class="flex justify-center mt-1">${getStars(i.rating)}</div>
                            <a href="${REVIEW_URL}" target="_blank" class="inline-block mt-3 text-[10px] bg-gray-50 text-gray-500 px-4 py-1.5 rounded-full shadow-sm hover:bg-gray-100"><i class="fa fa-pen mr-1"></i> Write Review</a>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm">
                            <h3 class="font-bold text-[#4B0082] border-b pb-2 mb-2 text-xs uppercase tracking-widest"><i class="fa fa-id-card mr-2 text-[#D4AF37]"></i> Basic Info</h3>
                            ${renderR('Description', i.desc)}${renderR('Category', i.cat)}${renderR('Type', i.type)}${renderR('Address', i.addr)}${renderR('Ward', i.ward)}
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm">
                            <h3 class="font-bold text-[#4B0082] border-b pb-2 mb-2 text-xs uppercase tracking-widest"><i class="fa fa-phone-volume mr-2 text-[#D4AF37]"></i> Contact</h3>
                            ${renderP('Phone 1', i.ph1)}${renderP('Phone 2', i.ph2)}
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm">
                            <h3 class="font-bold text-[#4B0082] border-b pb-2 mb-2 text-xs uppercase tracking-widest"><i class="fa fa-share-nodes mr-2 text-[#D4AF37]"></i> Digital Contact</h3>
                            ${renderC('Viber', i.viber, 'fab fa-viber', 'viber-bg', 'viber://chat?number=')}
                            ${renderC('Telegram', i.telegram, 'fab fa-telegram', 'telegram-bg', 'https://t.me/')}
                            ${renderC('Email', i.email, 'fa fa-envelope', 'bg-red-500', 'mailto:')}
                        </div>
                        ${i.note ? `<div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-yellow-400"><h3 class="font-bold text-[#4B0082] text-xs uppercase tracking-widest mb-2">Note</h3><p class="text-sm text-gray-600 post-content">${i.note}</p></div>` : ''}
                    </div>`;
            }
            modal.style.display = 'block'; document.body.style.overflow = 'hidden'; document.getElementById('bottomNav').style.transform = 'translateY(150%)';
        }

        function closeDetail() { document.getElementById('detailPage').style.display = 'none'; document.body.style.overflow = 'auto'; document.getElementById('bottomNav').style.transform = 'translateY(0)'; }

        function showPage(p) {
            document.querySelectorAll('.page').forEach(page => { page.classList.remove('active-page'); setTimeout(() => { if(!page.classList.contains('active-page')) page.style.display = 'none'; }, 100); });
            const active = document.getElementById(p + 'Page'); active.style.display = 'block'; setTimeout(() => active.classList.add('active-page'), 10);
            const navs = {'home': 'nav-home', 'directory': 'nav-directory', 'contact': 'nav-contact'};
            Object.values(navs).forEach(id => { const btn = document.getElementById(id); btn.classList.remove('text-[#FFD700]', 'scale-110'); if(id !== 'nav-directory') btn.classList.add('text-gray-400'); else btn.querySelector('div').classList.remove('ring-4', 'ring-[#FFD700]/30'); });
            const a = document.getElementById(navs[p]); if (p === 'directory') a.querySelector('div').classList.add('ring-4', 'ring-[#FFD700]/30'); else a.classList.add('text-[#FFD700]', 'scale-110');
            window.scrollTo(0,0);
        }
        loadAllData();
    </script>
</body>
</html>
